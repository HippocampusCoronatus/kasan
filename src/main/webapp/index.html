<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>かあさん貸借システム</title>
    <link rel="shortcut icon" href="./images/coin.png" />
    <link rel="stylesheet" href="./style/main.css" type="text/css" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    <script type="text/javascript">
        <!-- 直書きすいません -->
        function a(frm) {
            var namae = document.getElementById("input_name").value;
            if (!namae) {
                alert("名前を入力してください。");
                return;
            }
            var kingaku = document.getElementById("amount_of_maney").value;
            if (!kingaku) {
                alert("金額を入力してください。");
                return;
            }
            if (kingaku.match(/[^0-9]+/)) {
                alert("金額は半角数字でオナシャス");
                return;
            }
            alert('もらった！');
            frm.submit();
        }
    </script>
  </head>
  <body>
    <header></header>
    <div class="main">
      <div>かあさん貸借システム</div>
      <div><h3 id="h3_title" v-cloak>{{name}}</h3></div>
      <article id="account_list">
        <section>
          <h4>【あなたのかしかり】</h4>
          <p v-for="account in accountList" v-cloak>
            {{account.PartnerMemberID}} : {{account.LoanAmount}}
          </p>
        </section>
      </article>
      <form accept-charset="UTF-8" action="" method="">
        <div class="form-body">
          <label for="input_name">名前を入力してください。</label>
          <input type="text" class="input-block" name="input_name" id="input_name" placeholder="名前を入力してください。" autocomplete="name" />
          <label for="amount_of_maney">金額を入力してください。</label>
          <input type="text" class="input-block" name="amount_of_maney" id="amount_of_maney" placeholder="金額を入力してください。" />
          <div>
            <input type="button" class="btn btn-primary btn-block" value="確認" onclick="a(this.form)" />
          </div>
        </div>
      </form>
      <div id="logout"><a v-on:click="logout()">ログアウト</a></div>
    </div>
    <footer></footer>
    <script src="js/utilities/kasan.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <!-- 初期化通信直書き -->
    <script type="text/javascript">
      (function() {
        new Vue({
          el: "#logout",
          methods: {
            logout: function () {
              kasan.post("api/authentication/logout").then(
                function() {
                  location.href = "login_test.html";
                },
                function(reason) {
                  alert("ログアウトに失敗しました。");
                }
              );
            }
          }
        });
        kasan.get("api/members/me").then(
          function(result) {
            if (!result) {
              location.href = "login_test.html";
            }
            var me = JSON.parse(result);
            new Vue({
              el: "#h3_title",
              data: {
                name: me.Name + "さんのページ"
              }
            });
          },
          function(result) {

          }
        );
        kasan.get("api/accounts").then(
          function(result) {
            var accounts = JSON.parse(result);
            new Vue({
              el: "#account_list",
              data: {
                accountList: accounts
              }
            });
          },
          function(result) {
            alert("初期化通信に失敗しました。");
          }
        );
      })();
    </script>
  </body>
</html>
